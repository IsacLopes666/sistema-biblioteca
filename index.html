<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Biblioteca Digital</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <!--  CABE√áALHO  -->
  <header>
    <h1>üìö Biblioteca Digital</h1>

    <!-- Menu escondido at√© o login -->
    <nav id="menu" style="display:none;">
      <a href="#" id="goList"> Lista de Livros</a>
      <a href="#" id="goRegister">Cadastrar Livro</a>
    </nav>

    <!-- Mostra nome do usu√°rio logado e bot√£o sair -->
    <div id="userInfo">
      <span id="userName"></span>
      <button id="logoutBtn" style="display:none;">Sair da Conta</button>
    </div>
  </header>

  <main>

    <!--  Login  -->
    <section id="login-section" class="active">
      <h2>Login</h2>
      <form id="loginForm">
        <input type="email" id="loginEmail" placeholder="Email" required>
        <input type="password" id="loginPassword" placeholder="Senha" required>
        <button type="submit">Entrar</button>
      </form>
      <p>N√£o tem conta? <a href="#" id="showRegister">Cadastre-se</a></p>
    </section>

    <!--  Cadastro De Usuario  -->
    <section id="register-section">
      <h2>Cadastro De Usuario</h2>
      <form id="registerForm">
        <input type="text" id="regName" placeholder="Nome" required>
        <input type="email" id="regEmail" placeholder="Email" required>
        <input type="password" id="regPassword" placeholder="Senha" required>
        <button type="submit">Cadastrar</button>
      </form>
      <p>J√° tem conta? <a href="#" id="showLogin">Fa√ßa login</a></p>
    </section>

    <!--  Lista De Livros -->
    <section id="list-section">
      <h2>Lista de Livros</h2>
      <ul id="bookList"></ul>
    </section>

    <!--  Cadastrar Livro -->
    <section id="system-section">
      <h2>Cadastrar Livro</h2>
      <div class="card-form">
        <form id="bookForm">
          <input type="text" id="title" placeholder="T√≠tulo" required>
          <input type="text" id="author" placeholder="Autor" required>
          <input type="text" id="genre" placeholder="G√™nero" required>
          <input type="number" id="year" placeholder="Ano" required>
          <textarea id="description" placeholder="Descri√ß√£o" required></textarea>
          <input type="file" id="image" accept="image/*">
          <button type="submit">Adicionar Livro</button>
        </form>

        <!--  imagem do livro -->
        <div class="preview-container">
          <img id="preview" src="" alt="Preview da capa" style="display:none;">
        </div>
      </div>
    </section>
  </main>

  <!--  Modal de Visualizar/Editar  -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <span id="closeModal">&times;</span>
      <h3 id="modalTitle"></h3>

      <!-- Exibe detalhes -->
      <div id="viewContent" style="display:none;">
        <p><strong>T√≠tulo:</strong> <span id="viewTitle"></span></p>
        <p><strong>Autor:</strong> <span id="viewAuthor"></span></p>
        <p><strong>G√™nero:</strong> <span id="viewGenre"></span></p>
        <p><strong>Ano:</strong> <span id="viewYear"></span></p>
        <p><strong>Descri√ß√£o:</strong> <span id="viewDescription"></span></p>
        <img id="viewImage" src="" alt="Capa" style="max-width:120px; margin-top:10px;">
      </div>

      <!-- Formul√°rio para editar livro -->
      <form id="editForm" style="display:none;">
        <input type="text" id="editTitle" placeholder="T√≠tulo" required>
        <input type="text" id="editAuthor" placeholder="Autor" required>
        <input type="text" id="editGenre" placeholder="G√™nero" required>
        <input type="number" id="editYear" placeholder="Ano" required>
        <textarea id="editDescription" placeholder="Descri√ß√£o" required></textarea>
        <input type="file" id="editImage" accept="image/*">
        <img id="editPreview" src="" alt="Preview da capa" style="max-width:100px; margin-top:10px;">
        <button type="submit">Salvar Altera√ß√µes</button>
      </form>
    </div>
  </div>

  <!--  Modal de Confirma√ß√£o se eu realmente desejo remover o livro  -->
  <div id="confirmModal" class="modal">
    <div class="modal-content">
      <h3>Confirma√ß√£o</h3>
      <p id="confirmMessage">Voc√™ deseja realmente remover este livro?</p>
      <div style="margin-top:15px; display:flex; justify-content:flex-end; gap:10px;">
        <button id="cancelDelete" style="background:#6c757d;">Cancelar</button>
        <button id="confirmDelete" style="background:#dc3545;">Remover</button>
      </div>
    </div>
  </div>

  <!-- Container das mensagens de notifica√ß√£o -->
  <div id="toast-container"></div>

  <!--  SCRIPT PRINCIPAL  -->
  <script>
  //  VARI√ÅVEIS GERAIS 
  let editingBook = null;     // guarda qual livro esta sendo editado
  let currentUser = null;     // guarda o usuario logado
  let bookToDelete = null;    // guarda o livro que sera excluido

  //  TOASTS (mensagens de alerta) 
  function showToast(message, type = "info") {
    const container = document.getElementById("toast-container");
    const toast = document.createElement("div");
    toast.classList.add("toast", type);
    toast.textContent = message;
    container.appendChild(toast);
    setTimeout(() => toast.remove(), 4000); 
  }

  //  TROCAR ENTRE LOGIN E CADASTRO 
  document.getElementById("showRegister").addEventListener("click", () => {
    document.getElementById("login-section").classList.remove("active");
    document.getElementById("register-section").classList.add("active");
  });
  document.getElementById("showLogin").addEventListener("click", () => {
    document.getElementById("register-section").classList.remove("active");
    document.getElementById("login-section").classList.add("active");
  });

  //  Cadastrar Usuario
  document.getElementById("registerForm").addEventListener("submit", (e) => {
    e.preventDefault();
    const name = document.getElementById("regName").value;
    const email = document.getElementById("regEmail").value;
    const password = document.getElementById("regPassword").value;
    localStorage.setItem("user", JSON.stringify({ name, email, password })); // salva no navegador
    showToast("Cadastro realizado com sucesso! Fa√ßa login.", "success");
    document.getElementById("register-section").classList.remove("active");
    document.getElementById("login-section").classList.add("active");
  });

  //  Login
  document.getElementById("loginForm").addEventListener("submit", (e) => {
    e.preventDefault();
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;
    const user = JSON.parse(localStorage.getItem("user")); // pega usu√°rio salvo
    if (user && user.email === email && user.password === password) {
      currentUser = user;
      showToast("Login realizado com sucesso!", "success");
      document.getElementById("userName").textContent = "üë§ " + user.name;
      document.getElementById("login-section").classList.remove("active");
      document.getElementById("list-section").classList.add("active");
      document.getElementById("logoutBtn").style.display = "inline-block";
      document.getElementById("menu").style.display = "flex";
    } else {
      showToast("Email ou senha incorretos.", "error");
    }
  });

  //  Sair Da conta
  document.getElementById("logoutBtn").addEventListener("click", () => {
    document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
    document.getElementById("login-section").classList.add("active");
    document.getElementById("logoutBtn").style.display = "none";
    document.getElementById("menu").style.display = "none";
    document.getElementById("userName").textContent = "";
    currentUser = null;
    showToast("Voc√™ saiu da conta.", "info");
  });

  //  NAVEGA√á√ÉO ENTRE TELAS 
  document.getElementById("goList").addEventListener("click", () => {
    document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
    document.getElementById("list-section").classList.add("active");
  });
  document.getElementById("goRegister").addEventListener("click", () => {
    document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
    document.getElementById("system-section").classList.add("active");
  });

  // Cadastrar Livro 
  const bookForm = document.getElementById("bookForm");
  const bookList = document.getElementById("bookList");
  const preview = document.getElementById("preview");

  // Mostra a imagem antes de adicionar
  document.getElementById("image").addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = () => {
        preview.src = reader.result;
        preview.style.display = "block";
      };
      reader.readAsDataURL(file);
    }
  });

  // Adiciona o livro √† lista
  bookForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const title = document.getElementById("title").value;
    const author = document.getElementById("author").value;
    const genre = document.getElementById("genre").value;
    const year = document.getElementById("year").value;
    const description = document.getElementById("description").value;
    const image = preview.src || "";

    // Cria o item da lista
    const li = document.createElement("li");
    li.innerHTML = `
      <div class="book-info">
        ${image ? `<img src="${image}" alt="Capa" class="book-cover">` : ""}
        <span><strong>${title}</strong> - ${author} (${year}) <br><em>${genre}</em></span>
      </div>
      <div>
        <button onclick="viewBook(this)">üëÅ Visualizar</button>
        <button onclick="editBook(this)">‚úèÔ∏è Atualizar</button>
        <button onclick="removeBook(this)">üóë Excluir</button>
      </div>
    `;
    li.dataset.title = title;
    li.dataset.author = author;
    li.dataset.genre = genre;
    li.dataset.year = year;
    li.dataset.description = description;
    li.dataset.image = image;
    bookList.appendChild(li);

    bookForm.reset();
    preview.src = "";
    preview.style.display = "none";
    showToast("Livro adicionado com sucesso!", "success");
    document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
    document.getElementById("list-section").classList.add("active");
  });

  // Se eu realmente desejo excluir o livro 
  function removeBook(btn) {
    bookToDelete = btn.parentElement.parentElement;
    const title = bookToDelete.dataset.title;
    document.getElementById("confirmMessage").textContent = `Voc√™ deseja realmente remover o livro "${title}"?`;
    document.getElementById("confirmModal").style.display = "flex";
  }

  document.getElementById("cancelDelete").addEventListener("click", () => {
    bookToDelete = null;
    document.getElementById("confirmModal").style.display = "none";
  });

  document.getElementById("confirmDelete").addEventListener("click", () => {
    if (bookToDelete) {
      bookToDelete.remove();
      showToast("Livro removido!", "error");
      bookToDelete = null;
    }
    document.getElementById("confirmModal").style.display = "none";
  });

  //  VISUALIZAR E EDITAR LIVROS 
  const modal = document.getElementById("modal");
  const closeModalBtn = document.getElementById("closeModal");
  const editForm = document.getElementById("editForm");

  function viewBook(btn) {
    const li = btn.parentElement.parentElement;
    document.getElementById("modalTitle").textContent = "Detalhes do Livro";
    document.getElementById("viewTitle").textContent = li.dataset.title;
    document.getElementById("viewAuthor").textContent = li.dataset.author;
    document.getElementById("viewGenre").textContent = li.dataset.genre;
    document.getElementById("viewYear").textContent = li.dataset.year;
    document.getElementById("viewDescription").textContent = li.dataset.description;
    document.getElementById("viewImage").src = li.dataset.image;
    document.getElementById("viewContent").style.display = "block";
    editForm.style.display = "none";
    modal.style.display = "flex";
  }

  function editBook(btn) {
    editingBook = btn.parentElement.parentElement;
    document.getElementById("modalTitle").textContent = "Editar Livro";
    document.getElementById("editTitle").value = editingBook.dataset.title;
    document.getElementById("editAuthor").value = editingBook.dataset.author;
    document.getElementById("editGenre").value = editingBook.dataset.genre;
    document.getElementById("editYear").value = editingBook.dataset.year;
    document.getElementById("editDescription").value = editingBook.dataset.description;
    document.getElementById("editPreview").src = editingBook.dataset.image;
    document.getElementById("viewContent").style.display = "none";
    editForm.style.display = "block";
    modal.style.display = "flex";
  }

  // Atualiza imagem no modo edi√ß√£o 
  document.getElementById("editImage").addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = () => {
        document.getElementById("editPreview").src = reader.result;
        editingBook.dataset.image = reader.result;
      };
      reader.readAsDataURL(file);
    }
  });

  // Fechar modal
  closeModalBtn.addEventListener("click", () => { modal.style.display = "none"; });
  window.addEventListener("click", (e) => { if (e.target === modal) modal.style.display = "none"; });

  // Salvar edi√ß√£o
  editForm.addEventListener("submit", (e) => {
    e.preventDefault();
    if (editingBook) {
      editingBook.dataset.title = document.getElementById("editTitle").value;
      editingBook.dataset.author = document.getElementById("editAuthor").value;
      editingBook.dataset.genre = document.getElementById("editGenre").value;
      editingBook.dataset.year = document.getElementById("editYear").value;
      editingBook.dataset.description = document.getElementById("editDescription").value;

      editingBook.querySelector(".book-info").innerHTML = `
        ${editingBook.dataset.image ? `<img src="${editingBook.dataset.image}" alt="Capa" class="book-cover">` : ""}
        <span><strong>${editingBook.dataset.title}</strong> - ${editingBook.dataset.author} (${editingBook.dataset.year}) 
        <br><em>${editingBook.dataset.genre}</em></span>
      `;
      showToast("Livro atualizado com sucesso!", "success");
      modal.style.display = "none";
    }
  });
  </script>
</body>
</html>
